import 'package:flutter/material.dart';
import 'package:flutter_localizations/flutter_localizations.dart';
import 'package:provider/provider.dart';
import 'models/favorites_model.dart';
import 'models/settings_model.dart';
import 'l10n/app_localizations.dart';
import 'package:constitution/routes/home_route/home_route.dart';

void main() {
  runApp(
    MultiProvider(
        providers: [
          ChangeNotifierProvider(builder: (context) => FavoritesModel()),
          ChangeNotifierProvider(builder: (context) => SettingsModel()),
        ],
        child: App()
    )
  );
}

class App extends StatefulWidget {
  @override
  _AppState createState() => _AppState();
}

class _AppState extends State<App> {

  @override
  initState() {
    super.initState();
  }

  ThemeData _getLightTheme(num fontSizeFactor) {
    ThemeData _theme = ThemeData.light();
    return _theme.copyWith(
        primaryColor: Colors.grey[900],
        accentColor: Colors.grey[900],
        cardTheme: _theme.cardTheme.copyWith(
          margin: const EdgeInsets.all(0),
          shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(8)),
        ),
        primaryTextTheme: _theme.primaryTextTheme.copyWith(
            headline: _theme.primaryTextTheme.headline.copyWith(
                //color: Colors.grey[900]
            )
        ),
        textTheme: TextTheme(
            body1: _theme.textTheme.body1.copyWith(
              fontSize: 16.0 * fontSizeFactor,
              height: 1.5
            ),
            title: _theme.textTheme.title.copyWith(
              fontSize: 20.0 * fontSizeFactor,
              height: 1.125
            ),
            subtitle: _theme.textTheme.subtitle.copyWith(
              fontSize: 16.0 * fontSizeFactor,
              height: 1.25,
              color: Colors.grey[700]
            )
        )
    );
  }

  ThemeData _getDarkTheme(num fontSizeFactor) {
    ThemeData _theme = ThemeData.dark();
    Color white87 = Color.fromRGBO(255, 255, 255, .87);
    return _theme.copyWith(
        primaryColor: Colors.grey[900],
        cardColor: _theme.primaryColor,
        cardTheme: _theme.cardTheme.copyWith(
          margin: const EdgeInsets.all(0),
          shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(8))
        ),
        scaffoldBackgroundColor: Colors.black87,
        canvasColor: Colors.grey[900],
        dialogTheme: _theme.dialogTheme.copyWith(
          backgroundColor: Colors.grey[900]
        ),
        iconTheme: _theme.iconTheme.copyWith(
          color: white87
        ),
        primaryTextTheme: _theme.primaryTextTheme.copyWith(
          headline: _theme.primaryTextTheme.headline.copyWith(
            color: Colors.grey[900]
          )
        ),
        textTheme: TextTheme(
            body1: _theme.textTheme.body1.copyWith(
              fontSize: 16.0 * fontSizeFactor,
              height: 1.5,
              color: white87
            ),
            title: _theme.textTheme.title.copyWith(
                fontSize: 20.0 * fontSizeFactor,
                height: 1.25,
                color: white87
            ),
            subtitle: _theme.textTheme.subtitle.copyWith(
                fontSize: 16.0 * fontSizeFactor,
                fontWeight: FontWeight.w400,
                height: 1.5,
                color: Colors.white70
            )
        )
    );
  }

  AppLocalizations getLocalizations(context, Locale locale) {
    return (locale != null) ? AppLocalizations(locale) : AppLocalizations.of(context);
  }

  @override
  Widget build(BuildContext context) {
    return Consumer<SettingsModel>(
      builder: (context, settings, child) {

        if (!settings.loaded) {
          return Center(
            child: CircularProgressIndicator(),
          );
        }

        return MaterialApp(
            theme: settings.isDarkThemeEnabled ?
              _getDarkTheme(settings.fontSizeFactor) :
              _getLightTheme(settings.fontSizeFactor),
            darkTheme: _getDarkTheme(settings.fontSizeFactor),
            localizationsDelegates: [
              GlobalMaterialLocalizations.delegate,
              GlobalWidgetsLocalizations.delegate,
              GlobalCupertinoLocalizations.delegate,
              AppLocalizations.delegate
            ],
            supportedLocales: [
              const Locale('ru'),
              const Locale('md'),
              const Locale('uk'),
            ],
            home: HomeRoute()//HomeRoute()
        );
      }
    );
  }
}